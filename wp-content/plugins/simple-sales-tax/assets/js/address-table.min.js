!function(o,n,s,e){o(function(){o("#address_table");var a=o("#address_table tbody"),e=s.template("sst-address-row"),r=s.template("sst-address-row-blank"),d=Backbone.Model.extend({addresses:{}});new(Backbone.View.extend({rowTemplate:e,initialize:function(){o(document.body).on("click",".sst-address-add",{view:this},this.onAddNewRow)},render:function(){var e=_.indexBy(this.model.get("addresses"),"ID"),s=this;s.$el.empty(),_.size(e)?o.each(e,function(e,d){s.renderRow(d)}):s.$el.append(r),s.initRows()},renderRow:function(e){var d=this;d.$el.append(d.rowTemplate(e)),d.initRow(e)},initRow:function(e){var d=this.$el.find('tr[data-id="'+e.ID+'"]');d.find('option[value="'+e.State+'"]').prop("selected",!0),e.Default&&d.find('input[type="checkbox"]').prop("checked",!0),d.find(".sst-address-delete").on("click",{view:this},this.onDeleteRow),d.find('input[type="checkbox"]').on("change",{view:this},this.defaultsChanged)},initRows:function(){var e=this.model,d=_.indexBy(e.get("addresses"),"ID"),s=this.$el;1==_.size(d)&&(d[Object.keys(d)[0]].Default="yes",e.set("addresses",d),s.find('input[type="checkbox"]').prop("checked",!0))},defaultsChanged:function(e){var d=e.data.view,s=d.model;_.indexBy(s.get("addresses"),"ID");tbody=d.$el,0==tbody.find('input[type="checkbox"]:checked').length&&(o(this).prop("checked",!0),alert(n.strings.one_default_required))},onAddNewRow:function(e){var d=e.data.view,s=d.model,t=_.indexBy(s.get("addresses"),"ID");address_id="new-"+(new Date).getTime(),address=_.defaults({ID:address_id},n.default_address),e.preventDefault(),t[address_id]=address,s.set("addresses",t),o("#sst-address-row-blank").remove(),d.renderRow(address),d.initRows()},onDeleteRow:function(e){var d=e.data.view,s=d.model,t=_.indexBy(s.get("addresses"),"ID"),n=o(this).closest("tr"),i=n.data("id");e.preventDefault(),t[i]&&(delete t[i],s.set("addresses",t),n.remove(),0==a.find("tr").length&&d.$el.append(r),d.initRows())}}))({model:new d({addresses:n.addresses}),el:a}).render()})}(jQuery,addressesLocalizeScript,wp,ajaxurl);